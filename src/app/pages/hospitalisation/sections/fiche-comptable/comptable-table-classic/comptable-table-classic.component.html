<form class="app-search d-none d-md-block">
  <div class="position-relative">
    <app-input [placeholder]="'Recherche'" [control]="search"></app-input>
    <span class="mdi mdi-magnify search-widget-icon"></span>
    <span class="mdi mdi-close-circle search-widget-icon search-widget-icon-close d-none"
      id="search-close-options"></span>
  </div>
</form>
<div class="table-responsive fiche-comptable">
  <!-- evolution tab -->
  <table *ngIf="typeData === 'evolution'" class="table table-responsive table-bordered align-middle table-nowrap mb-0">
    <thead>
      <tr>
        <th scope="col" class="text-center">Jours</th>
        <th scope="col" class="text-center"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let d of days; let k = index" class="cursor-pointer" (dblclick)="showEvolution(d.o)">
        <td class="evolution-day-content">{{ "J" + (d.i + 1) }}</td>
        <td class="t-content td-break w-700"
          [attr.data-item-id]="getEvolutionDataId(d.o)"
          [attr.data-item-day]="d.o" 
          [attr.data-item-typedata]="typeData" 
        >{{ getEvolutionData(d.o) }}</td>
      </tr>
    </tbody>
  </table>

  <table *ngIf="typeData !== 'evolution'" class="table table-responsive table-bordered align-middle table-nowrap mb-0">
    <thead>
      <tr>
        <th scope="col" class="fixed-column des-title">Désignation</th>
        <th scope="col" class="text-center" *ngFor="let d of days">{{ "J" + (d.i + 1) }}</th>
        <th scope="col" class="fixed-column text-right">Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of filtered_list; let i = index">
        <td class="fixed-column des-title">{{ item.libelle || item.nom_officiel }}</td>
        <td *ngFor="let d of days; let k = index" class="cursor-pointer t-content"
          [class.active]="setActive(d.o, item.id, typeData === 'chambres' ? item.chambre : null )"
          (dblclick)="dbClick(d.o, item.id, typeData === 'chambres' ? item.chambre : null)"
          (click)="sClick(d.o, item.id, typeData === 'chambres' ? item.chambre : null)"
          [attr.data-item-id]="getRowId(d.o, item.id, typeData === 'chambres' ? item.chambre : null )"
          [attr.data-item-day]="d.o" 
          [attr.data-item-typedata]="typeData" 
          [attr.data-item-type-id]="item.id"
          [attr.data-item-qte]="getRowQte(d.o, item.id, typeData === 'chambres' ? item.chambre : null )">
          {{ getRowQte(d.o, item.id, typeData === 'chambres' ? item.chambre : null ) }}
        </td>
        <td class="fixed-column text-right">{{ getTotal(item.id, typeData === 'chambres' ? item.chambre : null) }}</td>
      </tr>
    </tbody>
  </table>
</div>
<div class="row mt-4" *ngIf="numberOfPages > 1">
  <div class="col-sm-12 col-md-12 gridjs-pagination">
    <div class="gridjs-pages">
      <button role="button" title="Précédent" id="fixed-header_previous" *ngIf="currentPage > 1" (click)="previous()"
        [class.disabled]="currentPage === 1">
        Préc.
      </button>
      <button role="button" *ngFor="let index of visiblePageNumbers" [class.gridjs-currentPage]="currentPage === index"
        (click)="setCurrentPage(index)">
        {{ index === -1 ? '...' : index }}
      </button>
      <button role="button" id="fixed-header_next" *ngIf="!(currentPage === numberOfPages || !numberOfPages)"
        [class.disabled]="currentPage === numberOfPages || !numberOfPages" (click)="next()">
        Suiv.
      </button>
    </div>
  </div>
</div>

<!-- Evolution modal -->
<div *ngIf="typeData === 'evolution'">
<ng-template #evolutionEdition let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Mettre à jour l'évolution du malade</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">×</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-md-12">
          <app-text label="Commentaire" [isMandatory]="true" [control]="currentEvolution" [rows]="10" [fontSize]="'25px'"></app-text>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Annuler</button>
    <button type="button" class="btn btn-primary" (click)="SaveEvolution()">Enrégistrer</button>
  </div>
</ng-template>
</div>
