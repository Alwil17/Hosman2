<!-- Start Breadcrumbs -->
<app-breadcrumbs title="REQUÊTES SPéCIALES" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="col-lg-12">
  <div class="card">
    <div class="card-header">
      <div class="row g-3 align-items-center py-3">
        <div class="row col-md-8 col-xl-7 gap-3">
          <div class="col-md-3">
            <app-input label="Date de début" type="date" [maxDate]="today" [control]="startDateControl">
            </app-input>
          </div>
          <div class="col-md-3">
            <app-input label="Date de fin" type="date" [maxDate]="today" [control]="endDateControl">
            </app-input>
          </div>
          <div class="col-md-4">
            <app-select label="Critère de recherche" [clearable]="false" [options]="searchCriteria"
              [control]="searchControl"></app-select>
          </div>
          <div *ngIf="searchControl.value.id === 'sector'" class="col-md-6">
            <app-select label="Secteur" [clearable]="true" [options]="sectors" [control]="sectorControl"></app-select>
          </div>
          <div *ngIf="searchControl.value.id === 'doctor'" class="col-md-6">
            <app-select label="Docteur" [clearable]="true" [options]="doctors" [control]="doctorControl"></app-select>
          </div>
        </div>
        <div class="col-md-4 col-xl-5 align-items-end gap-3">
          <button type="button" class="btn btn-success btn-label ms-2" (click)="refreshRequestsList()">
            <i class="ri-history-line label-icon align-middle fs-16 me-2"></i>
            Aperçu
          </button>

          <button type="button" class="btn btn-primary btn-label ms-2" (click)="printReport('general')">
            <i class="ri-history-line label-icon align-middle fs-16 me-2"></i>
            Imprimer Vue globale
          </button>

          <button type="button" class="btn btn-primary btn-label ms-2" (click)="printReport('acte')">
            <i class="ri-history-line label-icon align-middle fs-16 me-2"></i>
            Financière imprimable
          </button>

          <button type="button" class="btn btn-success btn-label ms-2 disabled">
            <i class="ri-history-line label-icon align-middle fs-16 me-2"></i>
            Récap. général
          </button>

          
        </div>
      </div>
    </div>


    <div class="card-body">
      <div class="row">
        <div class="col-12">
          <div class="table-responsive table-card">
            <table class="table table-one-liner table-hover table-striped align-middle mb-0">

              <thead class="table-light text-muted">
                <tr>
                  <th scope="col">{{ "Date Consultation" | uppercase }}</th>
                  <th scope="col">{{ "ID" | uppercase }}</th>
                  <th scope="col">{{ "Nom" | uppercase }}</th>
                  <th scope="col">{{ "Prénom(s)" | uppercase }}</th>
                  <th scope="col">{{ "Né(e) le" | uppercase }}</th>
                  <th scope="col">{{ "Sexe" | uppercase }}</th>
                  <th scope="col">{{ "Médecin" | uppercase }}</th>
                  <th scope="col">{{ "Secteur" | uppercase }}</th>
                  <th scope="col">{{ "Actes" | uppercase }}</th>
                  <th scope="col">{{ "Total Facture" | uppercase }}</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of requestsListCut" class="user-select-none">
                  <td>{{ item.date_consultation | date : 'dd/MM/yyyy' }}</td>
                  <td>{{ item.reference }}</td>
                  <td>{{ item.patient.nom }}</td>
                  <td>{{ item.patient.prenoms }}</td>
                  <td>{{ item.patient.date_naissance | date : 'dd/MM/yyyy' }}</td>
                  <td>{{ item.patient.sexe }}</td>
                  <td>{{
                    item.attente
                    ? item.attente.medecin_consulteur?.nom +
                    " " +
                    item.attente.medecin_consulteur?.prenoms
                    : "-"
                    }}</td>
                  <td>{{ item.secteur_code ? item.secteur.libelle : "-" }}</td>
                  <td class="td-ellipsis">
                    <!-- <span
                          *ngFor="let prestation of item.facture.prestation.tarifs"
                        >
                          {{ prestation.libelle + " " }}
                        </span> -->

                    <ng-container *ngFor="
                            let prestation of item.actes
                              | slice : 0 : 5;
                            index as i;
                            count as c
                          ">
                      <span>
                        {{ prestation.libelle }}
                      </span>
                      <span *ngIf="i < 4 && c !== i + 1"> <b>*</b> </span>
                      <span *ngIf="
                              i == 4 && c < item.actes.length
                            "><b> * ... </b></span>
                    </ng-container>
                  </td>
                  <td>{{ (item.attente && item.attente.facture) ? item.attente.facture.total : 0 | mask : "separator" }}
                  </td>

                  <td>
                    <div class="d-inline-block" ngbDropdown container="body">
                      <button type="button"
                        class="btn btn-icon btn-outline-dark btn-sm waves-effect waves-light arrow-none"
                        ngbDropdownToggle>
                        <i class="ri-more-fill fs-24"></i>
                      </button>
                      <div ngbDropdownMenu>
                        <button ngbDropdownItem>
                          <i class="ri-information-line label-icon align-middle fs-16 me-2 text-success"></i>
                          Voir
                        </button>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-12">
          <div class="d-flex justify-content-between p-2">
            <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize"
              (pageChange)="refreshRequestsList()">
            </ngb-pagination>

            <select class="form-select" style="width: auto" [(ngModel)]="pageSize"
              (ngModelChange)="refreshRequestsList()">
              <option [ngValue]="10">10 éléments par page</option>
              <option [ngValue]="15">15 éléments par page</option>
              <option [ngValue]="20">20 éléments par page</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>