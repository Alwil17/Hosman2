<!-- Start Breadcrumbs -->
<app-breadcrumbs
  title="BASE MEDICALE"
  [breadcrumbItems]="breadCrumbItems"
></app-breadcrumbs>
<!-- End Breadcrumbs -->

<!-- FIRST FORM CARD -->
<app-card>
  <!-- HEADER -->
  <ng-container customCardHeader>
    <div class="d-flex justify-content-between align-items-end">
      <h4>
        <span class="badge bg-primary me-3"
          ><i class="mdi mdi-circle-medium"></i>
          {{
            patientService.getActivePatient().reference +
              " - " +
              patientService.getActivePatient().nom +
              " " +
              patientService.getActivePatient().prenoms
          }}</span
        >
      </h4>

      <h5>Infos patient</h5>

      <div>
        <button
          type="button"
          class="btn btn-info btn-label waves-effect waves-light me-3"
          (click)="isPatientInfoCollapsed = !isPatientInfoCollapsed"
          [attr.aria-expanded]="!isPatientInfoCollapsed"
          aria-controls="collapseExample"
        >
          <i class="ri-information-line label-icon align-middle fs-16 me-2"></i>
          <span *ngIf="isPatientInfoCollapsed; else seeLess">Voir plus</span>
          <ng-template #seeLess>
            <span> Voir moins </span>
          </ng-template>
        </button>

        <button
          type="button"
          class="btn btn-warning btn-label waves-effect waves-light"
        >
          <!-- (click)="openPatientModificationModal()" -->
          <i class="ri-pencil-fill label-icon align-middle fs-16 me-2"></i>
          Modifier
        </button>
      </div>
    </div>
  </ng-container>

  <!-- BODY/CONTENT -->
  <ng-container customCardBody>
    <form
      [formGroup]="patientVisitForm1"
      [(ngbCollapse)]="isPatientInfoCollapsed"
    >
      <div class="row">
        <ng-container formArrayName="chronicDiseases">
          <ng-container
            *ngFor="
              let chronicDisease of chronicDiseasesFields.controls;
              let i = index;
              let count = count
            "
          >
            <div class="col-md-4 mb-3">
              <div class="row g-2">
                <div class="col-md-8">
                  <app-select
                    [label]="'Maladie chronique ' + (i + 1)"
                    [options]="[]"
                    [control]="chronicDisease"
                  ></app-select>
                </div>

                <div class="col-md-4 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light me-1"
                    (click)="addChronicDiseaseField()"
                  >
                    <i class="ri-add-fill fs-24"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light"
                    (click)="count !== 1 ? removeChronicDiseaseField(i) : null"
                  >
                    <i class="ri-subtract-fill fs-24"></i>
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <app-select
            label="Statut"
            [options]="[]"
            [control]="statusControl"
          ></app-select>
        </div>

        <div class="col-md-6 mb-3">
          <app-select
            label="Antécédents"
            [options]="[]"
            [control]="backgroundControl"
          ></app-select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <label for="comments" class="form-label"> Commentaires </label>
          <textarea
            id="comments"
            class="form-control"
            placeholder="..."
            rows="2"
            [formControl]="commentsControl"
            [ngClass]="{
              'is-invalid':
                ((commentsControl.touched && commentsControl.dirty) ||
                  isFormSubmitted) &&
                commentsControl.errors
            }"
          ></textarea>
        </div>
      </div>
    </form>
  </ng-container>
</app-card>

<!-- SECOND FORM CARD -->
<app-card>
  <!-- HEADER -->
  <ng-container customCardHeader>
    <div class="d-flex justify-content-between align-items-end">
      <div class="d-inline-block">
        <h5>Consultation</h5>
      </div>

      <div>
        <button
          type="button"
          class="btn btn-info btn-label waves-effect waves-light me-3"
        >
          <!-- (click)="openPatientModificationModal()" -->
          <i class="ri-information-line label-icon align-middle fs-16 me-2"></i>
          Voir les anciennes consultations
        </button>

        <button
          type="button"
          class="btn btn-danger btn-label waves-effect waves-light"
        >
          <!-- (click)="openPatientModificationModal()" -->
          <i class="ri-close-fill label-icon align-middle fs-16 me-2"></i>
          Annuler la consultation
        </button>
      </div>
    </div>
  </ng-container>

  <!-- BODY/CONTENT -->
  <ng-container customCardBody>
    <div class="d-flex justify-content-between mb-4">
      <button class="btn btn-secondary">Détails de l'attente</button>

      <div
        class="d-flex justify-content-between align-items-center border border-dark border-1 px-1"
      >
        <div class="me-5">
          <h5 class="m-0">
            <b>Acte: </b> <span class="text-secondary"><b>RL</b></span>
          </h5>
        </div>
        <div>
          <h5 class="m-0">
            <b>Frais: </b> <span class="text-secondary"><b>0</b></span>
          </h5>
        </div>
        <div class="ms-5">
          <h5 class="m-0">
            <b>Heure: </b>
            <span class="text-secondary"
              ><b>{{ today | date : "HH:mm:ss" }}</b></span
            >
          </h5>
        </div>
      </div>

      <button class="btn btn-secondary">Fichiers attachés</button>
    </div>

    <form [formGroup]="patientVisitForm2">
      <!-- FIRST PART -->
      <div class="row mb-2">
        <div class="col-md-2">
          <app-input
            label="Poids (kg)"
            maskFormat="999"
            [control]="weightControl"
          ></app-input>
        </div>

        <div class="col-md-2">
          <app-input
            label="Taille (cm)"
            maskFormat="999"
            [control]="sizeControl"
          ></app-input>
        </div>

        <div class="col-md-1">
          <app-input
            label="PC (cm)"
            maskFormat="999"
            [control]="pcControl"
          ></app-input>
        </div>

        <div class="col-md-2">
          <app-input
            label="Température (°C)"
            maskFormat="999"
            [control]="temperatureControl"
          ></app-input>
        </div>

        <div class="col-md-1">
          <app-input
            label="FR"
            maskFormat="999"
            [control]="frControl"
          ></app-input>
        </div>

        <div class="col-md-2">
          <app-input
            label="Pouls"
            maskFormat="999"
            [control]="pulseControl"
          ></app-input>
        </div>

        <div class="col-md-2">
          <app-input
            label="Tension (mmHg)"
            maskFormat="999"
            [control]="tensionControl"
          ></app-input>
        </div>
      </div>

      <hr />

      <!-- SECOND PART -->
      <div class="row mb-2">
        <div class="col-md-4">
          <div class="row g-2">
            <!-- <div class="col-md-2 d-flex align-items-center">
              <label class="form-label m-0">Acte</label>
            </div> -->
            <ng-container formArrayName="acts">
              <ng-container
                *ngFor="
                  let act of actsFields.controls;
                  let i = index;
                  let count = count
                "
              >
                <div class="col-md-8">
                  <app-select
                    [label]="'Acte ' + (i + 1)"
                    [options]="[]"
                    [control]="act"
                  ></app-select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light me-1"
                    (click)="addActsField()"
                  >
                    <i class="ri-add-fill fs-24"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light"
                    (click)="count !== 1 ? removeActsField(i) : null"
                  >
                    <i class="ri-subtract-fill fs-24"></i>
                  </button>
                </div> </ng-container
            ></ng-container>
          </div>
        </div>

        <div class="col-md-4">
          <div class="row g-2">
            <!-- <div class="col-md-2 d-flex align-items-center">
              <label class="form-label m-0">Motif</label>
            </div> -->
            <ng-container formArrayName="motifs">
              <ng-container
                *ngFor="
                  let motif of motifsFields.controls;
                  let i = index;
                  let count = count
                "
              >
                <div class="col-md-8">
                  <div class="col-md-12">
                    <app-select
                      [label]="'Motif ' + (i + 1)"
                      [options]="motifs"
                      [control]="motif"
                    ></app-select>
                  </div>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light me-1"
                    (click)="addMotifsField()"
                  >
                    <i class="ri-add-fill fs-24"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light"
                    (click)="count !== 1 ? removeMotifsField(i) : null"
                  >
                    <i class="ri-subtract-fill fs-24"></i>
                  </button>
                </div>
                <div class="col-md-8">
                  <textarea
                    class="form-control"
                    placeholder="Caractères du motif"
                    rows="2"
                  ></textarea>
                  <!-- [formControl]="diseaseHistoryControl" -->
                </div>
              </ng-container></ng-container
            >
          </div>
        </div>

        <div class="col-md-4">
          <div class="row g-2">
            <!-- <div class="col-md-3 d-flex align-items-center">
              <label class="form-label m-0">Diagnostic</label>
            </div> -->
            <ng-container formArrayName="diagnostics">
              <ng-container
                *ngFor="
                  let diagnostic of diagnosticsFields.controls;
                  let i = index;
                  let count = count
                "
              >
                <div class="col-md-8">
                  <app-select
                    [label]="'Diagnostic ' + (i + 1)"
                    [options]="diagnostics"
                    [control]="diagnostic"
                    [canAddOption]="true"
                  ></app-select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light me-1"
                    (click)="addDiagnosticsField()"
                  >
                    <i class="ri-add-fill fs-24"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-dark btn-icon waves-effect waves-light"
                    (click)="count !== 1 ? removeDiagnosticsField(i) : null"
                  >
                    <i class="ri-subtract-fill fs-24"></i>
                  </button>
                </div>
                <div class="col-md-8">
                  <textarea
                    class="form-control"
                    placeholder="Commentaies du diagnostic"
                    rows="2"
                  ></textarea>
                  <!-- [formControl]="diseaseHistoryControl" -->
                </div>
              </ng-container></ng-container
            >
          </div>
        </div>
      </div>

      <hr />

      <!-- THIRD PART -->
      <div class="row">
        <div class="col-lg-9">
          <div class="col-md-12 mb-3">
            <label for="diseaseHistory" class="form-label">
              Histoire de la maladie
            </label>
            <textarea
              id="diseaseHistory"
              class="form-control"
              placeholder="..."
              rows="3"
              [formControl]="diseaseHistoryControl"
              [ngClass]="{
                'is-invalid':
                  ((commentsControl.touched && commentsControl.dirty) ||
                    isFormSubmitted) &&
                  commentsControl.errors
              }"
            ></textarea>
          </div>

          <div class="col-md-12 mb-md-3 mb-lg-0">
            <label for="diseaseHistory" class="form-label">
              Médicaments prescrits
            </label>
            <textarea
              id="diseaseHistory"
              class="form-control"
              placeholder="..."
              rows="3"
              [formControl]="prescribedMedicationControl"
              [ngClass]="{
                'is-invalid':
                  ((commentsControl.touched && commentsControl.dirty) ||
                    isFormSubmitted) &&
                  commentsControl.errors
              }"
            ></textarea>
          </div>
        </div>

        <div class="col-lg-3 d-flex align-items-end">
          <div class="row gy-3">
            <div class="col-md-6 d-grid">
              <button class="btn btn-outline-secondary">
                <b>Ordonnancier</b>
              </button>
            </div>
            <div class="col-md-6 d-grid">
              <button
                class="btn btn-outline-success"
                (click)="openAppointmentModal()"
              >
                <b>Rendez-vous</b>
              </button>
            </div>

            <div class="col-md-6 d-grid">
              <button class="btn btn-outline-success"><b>Examens</b></button>
            </div>
            <div class="col-md-6 d-grid">
              <button class="btn btn-outline-secondary">
                <b>Hospitaliser</b>
              </button>
            </div>

            <div class="col-md-6 d-grid">
              <button
                type="button"
                class="btn btn-outline-secondary btn-label btn-sm"
              >
                <i
                  class="ri-save-2-line label-icon align-middle fs-16 me-2"
                ></i>

                Enregistrer et retourner sur la liste d'attente
              </button>
            </div>
            <div class="col-md-6 d-grid">
              <button
                type="button"
                class="btn btn-outline-success btn-label btn-sm"
              >
                <i
                  class="ri-save-2-fill label-icon align-middle fs-16 me-2"
                ></i>

                Enregistrer et quitter
              </button>
            </div>

            <div class="col-md-6 d-grid">
              <button class="btn btn-outline-success"><b>ATRD</b></button>
            </div>
            <div class="col-md-6 d-grid">
              <button class="btn btn-outline-secondary"><b>M-U</b></button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </ng-container>
</app-card>
